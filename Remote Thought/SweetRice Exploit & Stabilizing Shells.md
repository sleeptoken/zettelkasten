
2024-06-12 19:21

Source: #tryhackme #CTF #privesc 

Tags: [[shell]] [[sudo]] [[shellspawn]] [[linux]]

`searchsploit -x path` - use this to see details about the exploit and then configure that exploit according to the current machine

if you don't know the version of a service running, then simply search the exploit on exploitDB and guess the version 

sometimes to find the login page you might have to 
- do recursive gobusting 
- look at the documentation of the web app

use `rlwrap` with your `nc` commands - ability to use arrow keys and access command history 
#### Spawning a TTY shell

```
/usr/bin/script -qc /bin/bash /dev/null

#background the session using ctrl + z

stty raw -echo

#foreground the session using nc -nlvp previous_listening_port 

export TERM=xterm
```
use the above to spawn a TTY shell without using py

```
python -c 'import pty; pty.spawn("/bin/bash")'
```
use the above to upgrade the shell using py 

when ever you get a [[revshell]] don't `cd` into dir's instead use `ls` to check out content and then cat out the desired content - because sometimes the machine might take time to change dirs
#### Privilege escalation 
\
always run sudo -l to check if sudo entry is available 
if you are `www-data` on a linux machine then you should check sudo for privesc

checkout Tib3rius udemy course on Linux privesc for the [[rootbash]] method, briefly this method - 
- Creates an SUID version of bash that we just chuck in the temp folder that way it's gone when the system reboots (easy cleanup) and we can just run it with the dash P option to become root

```
echo "cp /bin/bash /tmp/rootbash, chmod +s /tmp/bash" > /etc/copy.sh
```

here the whole thing is being copied to `/etc/copy `because in the current box that is the only file that can run with sudo privileges
after running this command check out `sudo -l `to see the perms for current user, further take the`sudo -l` output and sudo that path 
eg. `sudo /usr/bin/perl /home/itguy/backup.pl`
check `tmp` dir, it should have the rootbash binary. run that rootbash binary with `-p` and become root


### References

[TryHackMe | LazyAdmin](https://tryhackme.com/r/room/lazyadmin)

[walkthrough by darksec](https://www.youtube.com/watch?v=Tf8mMs0lvPA)