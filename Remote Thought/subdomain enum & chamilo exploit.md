
2024-07-30 18:14

Source: #CTF 

Tags: [[linux]]
## Recon

- `nmap` tells us we have 2 ports open one is ssh and the other is http 
- the website hosted doesn't have any good stuffs on the face of it
- directory busting results aren't interesting either.
### Subdomain Enumeration

##### using wfuzz 
```
wfuzz -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u http://permx.htb/ -H 'Host:FUZZ.permx.htb' -t 50 --hc 302
```
##### using fuff
```
ffuf -w /usr/share/wordlists/seclists/Discovery/Web-Content/big.txt -u http://permx.htb -H "Host: FUZZ.permx.htb" -fw 18
```

we find `lms` and `www` as subdomains 
add these in the `/etc/hosts` file as 

```
10.10.11.23 permx.htb
10.10.11.23 lms.permx.htb
```

`lms.permx.htb` has `chamilo` software login page 
we try to find exploits for that version of the software 
### Exploiting

download the exploit from `github` and also the `revshell` from the links in References 
put the command as directed in `github` and get a `revshell`

> *agar koi `lms` ke exploit le through shell milta hai toh check for config files in the machine* 

- or just have `linpeas` find it for you 
in the current box we have config files that reveal database passwords in the `/var/www/chamilo/app/config/configuration.php` 

since we found user named `mtz` in the home directory of the web server we are going to try logging in via ssh as `mtz` user 
### Privilege escalation 

on running `sudo -l` we find that we can only run a custom script (`/opt/act.sh`) with [[sudo]] [[Privilege Escalation]]

This script allows the user `mtz` to change permissions on a file for any user, as long as the target file is within the `/home/mtz` directory.

To allow the user `mtz` to give read/write permissions to himself, we must change the “`/etc/sudoers`” file, and as we know the user `mtz` can only give permissions for files with the “`/home/mtz`” directory. This gave me the idea to create a [[symbolic link]] to the “`/etc/sudoers`” file on the “`/home/mtz`” directory so that the user `mtz` can modify the “`/etc/sudoers`” file indirectly using the following command.

```
mtz@permx:~$ ln -s /etc/sudoers /home/mtz/sudoers  
mtz@permx:~$ sudo /opt/acl.sh mtz rw /home/mtz/sudoers
```

We then modify on the “`/home/mtz/sudoers`” the last line and make it as follow:

```
mtz ALL=(ALL:ALL) NOPASSWD: ALL
```

We can now get root access using `sudo su`.
### References
https://app.hackthebox.com/machines/PermX

walkthrough - 
[Permx - HackTheBox Writeup | Anish Kumar Roy](https://anishkumarroy.github.io/posts/permx-htb/)
https://drive.google.com/file/d/1UvR-TKZbYkpSEcUXKabYzl8PlZJHaw6y/view
[PermX | HTB Writeup by Infinite_Exploit | Jul, 2024 | Medium](https://medium.com/@Infinite_Exploit/permx-htb-writeup-season-5-136bfcb54ac2)
source code of custom script which can run w sudo privileges ->  [PermX — Season 5 HTB Machine Writeup | by 0xJosep | Jul, 2024 | Medium](https://0xjosep.medium.com/permx-season-5-htb-machine-writeup-cf6e160e754a) 

exploit - https://github.com/Ziad-Sakr/Chamilo-CVE-2023-4220-Exploit/tree/main

php rev shell - https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php