
2025-05-23 12:22

Source: #tryhackme #CTF 

Tags: [[PCAP analysis]]

# TL;DR

we are given a PCAP file which captures a conversation where a bunch of images are parsed, follow the TCP stream, save the HEX stream, run a py script to find where the headers of a new image starts and separate out the files 
# Identify 

Pick any one of the requests, right click on TCP segment data and copy as a HEX Stream
go to cyber chef and paste the copied values 

Now you got to remove the part of the header - Boundary String , we use `drop bytes` for that 

identify the number of bytes the header is taking up from the start, here it is talking up 158 bytes (written where input and output is divided in the RHS of the page, shows up after selecting the part you want to delete)

In the Recipe section 
- Drop bytes - length - 158 
- From Hex 
- Render Image 
# Binwalk 

```sh
binwalk --dd='.*' -e security-footage-1648933966395.pcap
```
this dumps all the images in a new folder, but this also produces some corrupt images 

# Py Script - Traditional 

Click on anyone of the request then follow -> TCP stream , Show as -> Raw , then hit save   
create a py script to extract images
```python 
# script generated by ChatGPT
# script for tryhackme room Security Footage https://tryhackme.com/room/securityfootage
# you need to export raw data using wireshark follow tcp stream, save data as image.raw
import re

data = open('image.raw','rb').read()
frames = re.findall(b'\xff\xd8.*?\xff\xd9', data, re.DOTALL)
for i, f in enumerate(frames):
    open(f'frame_{i:04d}.jpg','wb').write(f)
print(f"Extracted {len(frames)} frames")
```

make sure the script and the raw file is in the same folder 
This produces all the images in a proper sequence 
# Foremost 

```sh
foremost -i security-footage-1648933966395.pcap -o output_dir
```
more  detailed - has audit logs
but can create corrupt images, mostly in the proper sequence 
### Create Video

```sh
ffmpeg -framerate 10 -pattern_type glob -i '*.jpg' -c:v libx264 footage.mp4
```
run this command while in the directory of extraced images
### Create GIF

```sh
ffmpeg -framerate 10 -pattern_type glob -i '*.jpg' -vf "scale=640:-1:flags=lanczos" output.gif
convert -delay 20 -loop 0 *.jpg output2.gif
```
### Create PDF

```sh
convert *.jpg output.pdf
```

to extract text from images use cloud vision API
https://cloud.google.com/vision/docs/drag-and-drop
### References
https://www.youtube.com/watch?v=t3uQYJiBqzo&t=192s