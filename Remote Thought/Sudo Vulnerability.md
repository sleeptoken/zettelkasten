
2024-06-06 14:29

Source: #tryhackme #privesc #CTF 

Tags: [[linux]]
### Pay close attention to the messages displayed in every step

The default landing page is usually entirely self-contained in that it has an inline stylesheet, rather than linking to an external stylesheet

In this room you download an image from a hidden directory (obtained from capturing req. on burp) from the website 

- use exiftool for finding out details about an image 
- strings print the sequences of printable characters in files

[[hydra]] can be used to brute force via password list to login to ftp
`hydra  -l  user_name  -P  password_list  ip_paddress  service_name(eg. ftp) `

`locate` can be used directly to search for all the files containing a keyword 

### Privilege Escalation

`sudo -V `    to find the version of sudo 
`sudo -l`      list the privileges for the invoking user on the current host 
output - 
`(ALL, !root)  NOPASSWD:  /usr/bin/vi  /home/gwendoline/user.txt`
 We’re allowed to execute a single command with sudo as user Gwendoline: specifically, we can use the vi text editor to open the user flag. Now, usually this would be an easy privesc — open the file using sudo vi then execute `/bin/bash` from inside the environment;

 instead of having `(ALL, ALL)` inside the brackets of who we can run commands as, we have `(ALL, !root)` meaning that we can’t use sudo as root, but we can use it as anyone else

a vulnerability (CVE-2019-14287) in bash itself that allows us to get around this specific sudo configuration and execute the command as root regardless. [White Source Software](https://resources.whitesourcesoftware.com/blog-whitesource/new-vulnerability-in-sudo-cve-2019-14287) has a really good explanation of this vulnerability

 if you select a user with an id of -1, [[sudo]] can’t cope with it and just reverts back to 0 (i.e. the id of the root user). What this means is that, whilst we can’t execute commands as the user with id 0 (root), we _can_ execute commands as any other user, including -1, which reverts back to root, thus bypassing the restriction

`sudo -u#-1 /usr/bin/vi /home/gwendoline/user.txt`
once vi opens use `:!/bin/bash` to get root shell 

### References

[TryHackMe | Year of the Rabbit](https://tryhackme.com/r/room/yearoftherabbit)

writeup - 
[Year of the Rabbit -- Write-up | MuirlandOracle | Blog](https://muirlandoracle.co.uk/2020/03/10/year-of-the-rabbit-write-up/)